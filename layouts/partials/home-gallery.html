<section class="gallery">
  <div id="random-gallery" class="gallery-grid">
    {{ $images := readDir "static/images/placeholders" }}
    {{ range $i, $img := $images }}
      <img class="gallery-img"
           src="/images/placeholders/{{ $img.Name }}"
           alt="{{ $img.Name }}"
           loading="lazy"
           style="display:none;">
    {{ end }}
  </div>

  <!-- Enlace centrado -->
  <p class="gallery-refresh-wrapper">
    <a id="gallery-refresh" class="gallery-refresh" href="#">
      ðŸ”„ Swipe / Click / Reload the Randomness
    </a>
  </p>
</section>

<!-- Lightbox container -->
<div id="lightbox-overlay">
  <img id="lightbox-image" src="" alt="">
</div>

<script>
  /* ---------- helpers ---------- */
  const shuffle = (arr) => {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  };
  const setSpanIfPanoramic = (img) => {
    const aspect = img.naturalWidth / img.naturalHeight;
    if (aspect >= 15 / 9) img.classList.add('span-full');
  };

  /* ---------- render gallery ---------- */
  const renderRandomGallery = () => {
    const all = Array.from(document.querySelectorAll('.gallery-img'));
    const random50 = shuffle(all).slice(0, 50);

    all.forEach(img => {
      img.style.display = 'none';
      img.classList.remove('span-full');
    });

    random50.forEach(img => {
      img.style.display = 'block';
      img.complete ? setSpanIfPanoramic(img)
                   : (img.onload = () => setSpanIfPanoramic(img));
    });
  };

  /* ---------- lightbox ---------- */
  const initLightbox = () => {
    const overlay = document.getElementById('lightbox-overlay');
    const bigImg  = document.getElementById('lightbox-image');

    document.querySelectorAll('.gallery-img').forEach(img => {
      img.addEventListener('click', () => {
        bigImg.src = img.src;
        overlay.style.display = 'flex';
      });
    });

    const close = () => { overlay.style.display = 'none'; bigImg.src = ''; };
    overlay.addEventListener('click', close);
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') close(); });
  };

  /* ---------- shuffle + scrollTop ---------- */
  const initRefreshLink = () => {
    const link = document.getElementById('gallery-refresh');
    link.addEventListener('click', (e) => {
      e.preventDefault();
      renderRandomGallery();                   // nuevas 50
      window.scrollTo({ top: 0, behavior: 'instant' }); // ya arriba
    });
  };

  /* ---------- init ---------- */
  document.addEventListener('DOMContentLoaded', () => {
    renderRandomGallery();
    initLightbox();
    initRefreshLink();
  });
</script>

<style>
  /* Enlace centrado */
  .gallery-refresh-wrapper { text-align: center; }
  .gallery-refresh {
    display: inline-block;
    margin-top: 2rem;
    font-size: 1.2rem;
    color: var(--highlight-color);
    text-decoration: none;
    opacity: 0.7;
    transition: opacity 0.2s ease;
    font-weight: 700;       /* negrita */
    letter-spacing: 0.05em; /* un poco mÃ¡s de aire entre letras */
  }
  .gallery-refresh:hover { opacity: 1; }
</style>